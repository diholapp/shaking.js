function ShakingAPI(){}ShakingAPI.prototype={API_KEY:"Get one at www.diholapp.com",user:"",lat:0,lng:0,sensibility:30,timingFilter:2e3,distanceFilter:100,keepSearching:!1,manualLocation:!1,accelerometer:null,connectOnlyWith:connectOnlyWith=[],stopped:!0,paused:!1,processing:!1,background:!1,vibrate:!0,start:function(){this.stopped&&(this.stopped=!1,this.paused=!1,this._getCurrentPosition(),this._subscribe())},stop:function(){this.stopped||(this.stopped=!0,this.paused=!1,this.processing=!1,this.accelerometer&&this._unsubscribe())},_restart:function(){this.stopped||this.processing||!this.paused||this.background||(this.paused=!1,this._getCurrentPosition(),this._subscribe())},_pause:function(){this.paused||(this.paused=!0,this.accelerometer&&this._unsubscribe())},simulate:function(){this._onShakingEvent()},configure:function(t){const{API_KEY:i,user:e,lat:s,lng:n,sensibility:o,timingFilter:r,distanceFilter:h,keepSearching:c,connectOnlyWith:a,vibrate:l,onShaking:u,onSuccess:E,onError:R}=t;return this.API_KEY=i,this.user=e,void 0!==o&&this.setSensibility(o),void 0!==r&&this.setTimingFilter(r),void 0!==h&&this.setDistanceFilter(h),void 0!==c&&this.setKeepSearching(c),void 0!==a&&this.setConnectOnlyWith(a),void 0!==l&&(this.vibrate=l),void 0!==s&&void 0!==n&&this.setLocation(s,n),this.onShaking=u,this.onSuccess=E,this.onError=R,this},setLocation:function(t,i){this.lat=t,this.lng=i,this.manualLocation=!0},setUser:function(t){this.user=t},setSensibility:function(t){this.sensibility=t},setTimingFilter:function(t){this.timingFilter=t},setDistanceFilter:function(t){this.distanceFilter=t},setKeepSearching:function(t){this.keepSearching=t},setConnectOnlyWith:function(t){this.connectOnlyWith=t},_subscribe:function(){try{this.accelerometer=new Accelerometer({frequency:60}),this.accelerometer.onreading=(()=>{const{x:t,y:i,z:e}=this.accelerometer;Math.abs(t)+Math.abs(i)+Math.abs(e)>this.sensibility&&this._onShakingEvent()}),this.accelerometer.onerror=(()=>this.onError(ShakingCodes.SENSOR_ERROR)),this.accelerometer.start()}catch(t){if(!(t instanceof ReferenceError))throw t;this.onError(ShakingCodes.SENSOR_ERROR)}},_unsubscribe:function(){this.accelerometer.stop()},_onShakingEvent:function(){this._pause(),this.vibrate&&navigator.vibrate(300),this.onShaking&&this.onShaking(),this._getCurrentPosition(),this._connect()},_connect:function(){this.processing=!0;let t={method:"POST",headers:{accept:"application/json","content-type":"application/json"},body:JSON.stringify({api_key:this.API_KEY,id:this.user,lat:this.lat,lng:this.lng,sensibility:this.sensibility,distanceFilter:this.distanceFilter,timingFilter:this.timingFilter,keepSearching:this.keepSearching,connectOnlyWith:this.connectOnlyWith})};fetch("https://api.diholapplication.com/shaking/connect",t).then(t=>t.json()).then(t=>this._handleServerResponse(t)).catch(t=>{this.processing=!1,this.onError(ShakingCodes.SERVER_ERROR),setTimeout(()=>{this._restart()},2e3),console.log(t)})},_handleServerResponse:function(t){const{status:i,response:e}=t;200==i.code?this.onSuccess(e):401==i.code?this.onError(ShakingCodes.AUTHENTICATION_ERROR):403==i.code?this.onError(ShakingCodes.API_KEY_EXPIRED):this.onError(ShakingCodes.SERVER_ERROR),this.processing=!1,this._restart()},_getCurrentPosition:async function(){this.manualLocation||navigator.geolocation.getCurrentPosition(t=>{this.lat=t.coords.latitude,this.lng=t.coords.longitude},t=>{1===t.code?this.onError(ShakingCodes.LOCATION_PERMISSION_ERROR):this.onError(ShakingCodes.LOCATION_DISABLED)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:1e4})}};const ShakingCodes={LOCATION_PERMISSION_ERROR:"LOCATION_PERMISSION_ERROR",LOCATION_DISABLED:"LOCATION_DISABLED",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",API_KEY_EXPIRED:"API_KEY_EXPIRED",TIMEOUT:"TIMEOUT",SERVER_ERROR:"SERVER_ERROR",SENSOR_ERROR:"SENSOR_ERROR"};